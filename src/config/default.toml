# Turbo CDN Default Configuration
# This file contains the default settings for Turbo CDN
# Last updated: 2025-12

[general]
# Enable debug mode for verbose logging
debug = false

# Default region for CDN selection
# Options: "Global", "China", "Asia", "AsiaPacific", "Europe", "NorthAmerica"
default_region = "Global"

# User agent string for HTTP requests
user_agent = "turbo-cdn/0.5.0"

# Enable URL mapping cache for faster repeated operations
enable_url_cache = true

# URL cache TTL in seconds (default: 1 hour)
url_cache_ttl = 3600

# Maximum cache entries to prevent memory bloat
max_cache_entries = 1000

[performance]
# Maximum number of concurrent downloads (increased for turbo speed)
max_concurrent_downloads = 32

# Chunk size for downloads in bytes (1MB for better concurrency)
chunk_size = 1048576

# Connection timeout in seconds
timeout = 30

# Maximum retry attempts for failed downloads
retry_attempts = 3

# Enable adaptive chunking based on connection speed
adaptive_chunking = true

# HTTP connection pool settings (increased for better performance)
pool_max_idle_per_host = 50
pool_idle_timeout = 90

# TCP keepalive timeout in seconds
tcp_keepalive = 60

# Enable HTTP/2 prior knowledge
http2_prior_knowledge = true

# Minimum chunk size in bytes (128KB for more granular chunks)
min_chunk_size = 131072

# Maximum chunk size in bytes (5MB)
max_chunk_size = 5242880

# Speed threshold for adaptive chunking in bytes per second (1MB/s)
speed_threshold_bytes_per_sec = 1048576

# Intelligent concurrency control (more aggressive)
adaptive_concurrency = true
min_concurrent_downloads = 8
max_concurrent_downloads_limit = 64
network_congestion_threshold = 0.3

# DNS cache settings
dns_cache_enabled = true
dns_cache_ttl_seconds = 300
dns_cache_max_entries = 1000

# Smart chunking settings
smart_chunking_enabled = true
chunk_performance_history_size = 100

[security]
# Verify SSL certificates
verify_ssl = true

# Allowed protocols for downloads
allowed_protocols = ["https", "http"]

[geo_detection]
# IP detection APIs for geographic location
ip_apis = [
    "https://ipapi.co/json/",
    "https://ip-api.com/json/",
    "https://ipinfo.io/json",
    "https://api.ipify.org?format=json"
]

# Timeout for IP detection requests in seconds
ip_detection_timeout = 5

# Enable automatic region detection
auto_detect_region = true

[testing]
# Test URLs for connectivity and speed testing (updated 2025-12)
test_urls = [
    # GitHub releases (latest stable versions)
    "https://github.com/BurntSushi/ripgrep/releases/download/14.1.1/ripgrep-14.1.1-x86_64-pc-windows-msvc.zip",
    "https://github.com/sharkdp/fd/releases/download/v10.2.0/fd-v10.2.0-x86_64-pc-windows-msvc.zip",
    "https://github.com/sharkdp/bat/releases/download/v0.24.0/bat-v0.24.0-x86_64-pc-windows-msvc.zip",

    # loonghao projects (our own tools)
    "https://github.com/loonghao/vx/releases/download/v0.2.3/vx-x86_64-pc-windows-msvc.zip",
    "https://github.com/loonghao/py2pyd/releases/download/v0.2.3/py2pyd-v0.2.3-cp312-cp312-win_amd64.whl",

    # jsDelivr CDN (latest versions)
    "https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js",
    "https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css",
    "https://cdn.jsdelivr.net/npm/vue@3.5.13/dist/vue.global.prod.js",

    # Fastly CDN
    "https://fastly.jsdelivr.net/npm/react@18.3.1/umd/react.production.min.js",

    # Cloudflare CDN
    "https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"
]

# Speed test file sizes (in bytes) for performance benchmarking
speed_test_sizes = [
    1048576,    # 1MB
    10485760,   # 10MB
    104857600   # 100MB
]

# =============================================================================
# URL Mapping Rules
# =============================================================================
# Rules are sorted by priority (lower number = higher priority)
# Only the first matching rule is applied
# Original URL is always added as fallback at the end

# -----------------------------------------------------------------------------
# GitHub Releases - Primary rule for all regions
# Verified working mirrors as of 2025-12
# Priority order based on availability testing
# -----------------------------------------------------------------------------
[[url_mapping_rules]]
name = "GitHub Releases - Primary"
pattern = "^https://github\\.com/([^/]+)/([^/]+)/releases/download/([^/]+)/(.+)$"
replacements = [
    # Verified working proxies (2025-12) - ordered by reliability
    "https://gh-proxy.com/https://github.com/$1/$2/releases/download/$3/$4",
    "https://ghproxy.net/https://github.com/$1/$2/releases/download/$3/$4",
    "https://ghfast.top/https://github.com/$1/$2/releases/download/$3/$4",
    "https://ghproxy.homeboyc.cn/https://github.com/$1/$2/releases/download/$3/$4",
    "https://gh.api.99988866.xyz/https://github.com/$1/$2/releases/download/$3/$4",
    "https://ghproxy.cc/https://github.com/$1/$2/releases/download/$3/$4",
    "https://mirror.ghproxy.com/https://github.com/$1/$2/releases/download/$3/$4",
    # Mirror sites
    "https://bgithub.xyz/$1/$2/releases/download/$3/$4",
    "https://kkgithub.com/$1/$2/releases/download/$3/$4",
    # Original as final fallback
    "https://github.com/$1/$2/releases/download/$3/$4"
]
regions = ["Global", "China", "Asia", "Europe", "NorthAmerica", "AsiaPacific"]
priority = 1
enabled = true

# -----------------------------------------------------------------------------
# GitHub Raw Files
# Verified working mirrors as of 2025-12
# -----------------------------------------------------------------------------
[[url_mapping_rules]]
name = "GitHub Raw Files"
pattern = "^https://raw\\.githubusercontent\\.com/([^/]+)/([^/]+)/([^/]+)/(.+)$"
replacements = [
    "https://gh-proxy.com/https://raw.githubusercontent.com/$1/$2/$3/$4",
    "https://ghproxy.net/https://raw.githubusercontent.com/$1/$2/$3/$4",
    "https://ghfast.top/https://raw.githubusercontent.com/$1/$2/$3/$4",
    "https://raw.gitmirror.com/$1/$2/$3/$4",
    "https://raw.githubusercontent.com/$1/$2/$3/$4"
]
regions = ["Global", "China", "Asia", "Europe", "NorthAmerica", "AsiaPacific"]
priority = 2
enabled = true

# -----------------------------------------------------------------------------
# GitHub Archive (zip/tar.gz downloads)
# Verified working mirrors as of 2025-12
# -----------------------------------------------------------------------------
[[url_mapping_rules]]
name = "GitHub Archive"
pattern = "^https://github\\.com/([^/]+)/([^/]+)/archive/(.+)$"
replacements = [
    "https://gh-proxy.com/https://github.com/$1/$2/archive/$3",
    "https://ghproxy.net/https://github.com/$1/$2/archive/$3",
    "https://ghfast.top/https://github.com/$1/$2/archive/$3",
    "https://github.com/$1/$2/archive/$3"
]
regions = ["Global", "China", "Asia", "Europe", "NorthAmerica", "AsiaPacific"]
priority = 3
enabled = true

# -----------------------------------------------------------------------------
# GitHub Blob/Tree (repository file access)
# -----------------------------------------------------------------------------
[[url_mapping_rules]]
name = "GitHub Blob"
pattern = "^https://github\\.com/([^/]+)/([^/]+)/blob/([^/]+)/(.+)$"
replacements = [
    "https://gh-proxy.com/https://github.com/$1/$2/blob/$3/$4",
    "https://ghproxy.net/https://github.com/$1/$2/blob/$3/$4",
    "https://github.com/$1/$2/blob/$3/$4"
]
regions = ["Global", "China", "Asia"]
priority = 4
enabled = true

# -----------------------------------------------------------------------------
# jsDelivr CDN
# -----------------------------------------------------------------------------
[[url_mapping_rules]]
name = "jsDelivr CDN"
pattern = "^https://cdn\\.jsdelivr\\.net/(.+)$"
replacements = [
    "https://fastly.jsdelivr.net/$1",
    "https://gcore.jsdelivr.net/$1",
    "https://testingcf.jsdelivr.net/$1",
    "https://cdn.jsdelivr.net/$1"
]
regions = ["Global", "China", "Asia", "Europe", "NorthAmerica"]
priority = 10
enabled = true

# -----------------------------------------------------------------------------
# npm Registry - China
# -----------------------------------------------------------------------------
[[url_mapping_rules]]
name = "npm Registry - China"
pattern = "^https://registry\\.npmjs\\.org/(.+)$"
replacements = [
    "https://registry.npmmirror.com/$1",
    "https://registry.npmjs.org/$1"
]
regions = ["China"]
priority = 20
enabled = true

# -----------------------------------------------------------------------------
# Python PyPI - China
# -----------------------------------------------------------------------------
[[url_mapping_rules]]
name = "Python PyPI - China"
pattern = "^https://pypi\\.org/simple/(.+)$"
replacements = [
    "https://pypi.tuna.tsinghua.edu.cn/simple/$1",
    "https://mirrors.aliyun.com/pypi/simple/$1",
    "https://pypi.org/simple/$1"
]
regions = ["China"]
priority = 21
enabled = true

# -----------------------------------------------------------------------------
# Python PyPI Files - China
# -----------------------------------------------------------------------------
[[url_mapping_rules]]
name = "Python PyPI Files - China"
pattern = "^https://files\\.pythonhosted\\.org/packages/(.+)$"
replacements = [
    "https://pypi.tuna.tsinghua.edu.cn/packages/$1",
    "https://mirrors.aliyun.com/pypi/packages/$1",
    "https://files.pythonhosted.org/packages/$1"
]
regions = ["China"]
priority = 22
enabled = true

# -----------------------------------------------------------------------------
# Rust Crates - China
# -----------------------------------------------------------------------------
[[url_mapping_rules]]
name = "Rust Crates - China"
pattern = "^https://crates\\.io/api/v1/crates/(.+)$"
replacements = [
    "https://mirrors.tuna.tsinghua.edu.cn/crates.io-index/$1",
    "https://mirrors.ustc.edu.cn/crates.io-index/$1",
    "https://crates.io/api/v1/crates/$1"
]
regions = ["China"]
priority = 23
enabled = true

# -----------------------------------------------------------------------------
# Go Modules - China
# -----------------------------------------------------------------------------
[[url_mapping_rules]]
name = "Go Modules - China"
pattern = "^https://proxy\\.golang\\.org/(.+)$"
replacements = [
    "https://goproxy.cn/$1",
    "https://goproxy.io/$1",
    "https://proxy.golang.org/$1"
]
regions = ["China"]
priority = 24
enabled = true

# -----------------------------------------------------------------------------
# Cloudflare CDN
# -----------------------------------------------------------------------------
[[url_mapping_rules]]
name = "Cloudflare CDN"
pattern = "^https://cdnjs\\.cloudflare\\.com/ajax/libs/(.+)$"
replacements = [
    "https://cdnjs.cloudflare.com/ajax/libs/$1",
    "https://cdn.jsdelivr.net/npm/$1",
    "https://unpkg.com/$1"
]
regions = ["Global", "Europe", "NorthAmerica"]
priority = 30
enabled = true

# -----------------------------------------------------------------------------
# unpkg CDN
# -----------------------------------------------------------------------------
[[url_mapping_rules]]
name = "unpkg CDN"
pattern = "^https://unpkg\\.com/(.+)$"
replacements = [
    "https://unpkg.com/$1",
    "https://cdn.jsdelivr.net/npm/$1",
    "https://fastly.jsdelivr.net/npm/$1"
]
regions = ["Global"]
priority = 31
enabled = true
