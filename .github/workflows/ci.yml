name: CI

on:
  pull_request:
    branches: [main]
  push:
    branches: [main]

permissions:
  contents: read
  actions: read
  security-events: write
  # Additional permissions for cross-platform testing
  packages: read

jobs:
  ci:
    uses: loonghao/rust-actions-toolkit/.github/workflows/reusable-ci.yml@v2.5.3
    with:
      enable-python-wheel: false
    secrets:
      CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}

  # Cross-platform testing using the same workflow as release
  cross-platform-test:
    uses: loonghao/rust-actions-toolkit/.github/workflows/reusable-release.yml@v2.5.3
    with:
      binary-name: "turbo-cdn"
      enable-python-wheels: false
